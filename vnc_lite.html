<!DOCTYPE html>
<html lang="en">
<head>
    <title>noVNC</title>

    <style>
        html, body {
            margin: 0;
            height: 100%;
            background-color: dimgrey;
            display: flex;
        }

        #screen {
            flex: 1; /* fill entire space */
            overflow: hidden;
        }
    </style>

    <script type="module" crossorigin="anonymous">
        import RFB from './core/rfb.js';

        let rfb;

        function credentialsAreRequired(e) {
            const password = prompt("Password required:");
            rfb.sendCredentials({ password: password });
        }

        function readQueryVariable(name, defaultValue) {
            const re = new RegExp('.*[?&]' + name + '=([^&#]*)'),
                  match = document.location.href.match(re);
            if (match) return decodeURIComponent(match[1]);
            return defaultValue;
        }

        // Read parameters from URL
        const host = readQueryVariable('host', window.location.hostname);
        let port = readQueryVariable('port', window.location.port);
        const password = readQueryVariable('password');
        const path = readQueryVariable('path', 'websockify');

        let url = (window.location.protocol === "https:" ? 'wss' : 'ws') + '://' + host;
        if(port) url += ':' + port;
        url += '/' + path;

        // Connect to the VNC server
        rfb = new RFB(document.getElementById('screen'), url, { credentials: { password: password } });
        rfb.addEventListener("credentialsrequired", credentialsAreRequired);

        // Optional parameters
        rfb.viewOnly = readQueryVariable('view_only', false);
        rfb.scaleViewport = readQueryVariable('scale', false);
    </script>
</head>

<body>
    <div id="screen">
        <!-- Remote screen appears here -->
    </div>
</body>
</html>
